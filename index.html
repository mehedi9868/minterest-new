<!-- index.html: Google Drive based gallery UI markup. All dynamic content is injected by app_min.js. -->
<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minterest — Drive Pins</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Header: branding bar with logo and Reset button -->
<header>
  <div class="logo" aria-label="Minterest">
    <div class="logo-badge">Mi</div>
    <div class="brand">Minterest</div>
  </div>

  <div id="user-info" class="user-info" style="display:none">
    <img id="user-photo" class="user-photo" alt="User">
    <div class="user-meta">
      <div id="user-name" class="user-name"></div>
      <div id="user-email" class="user-email"></div>
    </div>
  </div>

  <button id="hamburger" class="hamburger" aria-label="Menu" aria-haspopup="true" aria-expanded="false">
    <span></span><span></span><span></span>
  </button>

  <nav id="menu" class="menu" role="menu" aria-hidden="true">
    <button class="menu-item" data-action="reset"  role="menuitem">Reset</button>
    <a class="menu-item" href="signup.html" role="menuitem">Sign Up</a>
    <button class="menu-item" data-action="logout" role="menuitem">Log Out</button>
  </nav>
</header>

  <!-- Toggle Switch -->
  <!-- Toggle switch: switch between Images and Videos -->
  <div class="toggle-bar">
    <div class="toggle" id="mediaToggle" role="switch" aria-checked="false" tabindex="0" aria-label="Switch between Images and Videos">
      <span class="option image">Images</span>
      <span class="option video">Videos</span>
      <div class="slider"></div>
    </div>
  </div>

  <!-- Main content: responsive masonry grid that will be populated via JS -->
  <main class="shell">
    <!-- Grid container; JS injects cards (images/videos) here -->
    <section id="grid" aria-live="polite"></section>
  </main>

  <!-- Footer and copyright year -->
  <footer>
    <div class="tiny">© <span id="yr"></span> Mehedi • ❤</div>
  </footer>

  <!-- Floating Action Button: opens password modal to fetch Drive files -->
  <button id="fab" aria-label="Add" class="fab">+</button>

  <!-- Modal -->
  <!-- Password modal overlay (dialog for entering password) -->
  <div id="overlay" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <div class="body">
        <div class="row">
          <div class="label">Password</div>
          <div class="input"><input id="password" type="password" placeholder="Enter password" autofocus></div>
        </div>
      </div>
      <div class="foot">
        <button class="btn" id="btnCancel" type="button">Cancel</button>
        <button class="btn primary" id="btnAdd" type="button">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <!-- Toast: transient notification area -->
  <div id="toast"></div>

  <!-- Success Overlay -->
  <!-- Success overlay: shown after correct password; displays success image + loader -->
  <div id="success-overlay" class="success-overlay">
    <img src="success.jpg" alt="Success" class="success-image"/>
    <div class="loader"></div>
  </div>

  <!-- Main application script: handles Drive API calls, state, and UI events -->
  <script src="app_min.js"></script>
  <script>
    // Set current year dynamically in footer
    document.getElementById('yr').textContent = new Date().getFullYear();
  </script>


<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBP2mcTImq6j_IqtUBi-UmfbHV_2pc1Zuw",
    authDomain: "minterest-beta.firebaseapp.com",
    projectId: "minterest-beta",
    storageBucket: "minterest-beta.appspot.com",
    messagingSenderId: "822920853423",
    appId: "1:822920853423:web:9a426afa6fb3b8514ae15a",
    measurementId: "G-J3WZ8EL2XY"
  };
  if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
  const auth = firebase.auth();

  auth.onAuthStateChanged(user => {
    if (user) {
      console.log("Logged in:", user.email);
    } else {
      console.log("Not logged in");
    }
  });
</script>

<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const menu = $('#menu');
  const burger = $('#hamburger');
  const userInfo = $('#user-info');
  const uName = $('#user-name');
  const uEmail = $('#user-email');
  const uPhoto = $('#user-photo');

  // dropdown toggle
  if(burger){
    burger.addEventListener('click', ()=>{
      const hidden = menu.getAttribute('aria-hidden') === 'true';
      menu.setAttribute('aria-hidden', hidden ? 'false' : 'true');
      burger.setAttribute('aria-expanded', hidden ? 'true' : 'false');
    });
  }
  // close on outside click / ESC
  document.addEventListener('click', (e)=>{
    if(!menu) return;
    if(!menu.contains(e.target) && !burger.contains(e.target)){
      menu.setAttribute('aria-hidden','true'); burger.setAttribute('aria-expanded','false');
    }
  });
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape' && menu){
      menu.setAttribute('aria-hidden','true'); burger.setAttribute('aria-expanded','false');
    }
  });

  // actions
  if(menu){
    menu.addEventListener('click',(e)=>{
      const btn = e.target.closest('.menu-item'); if(!btn) return;
      const action = btn.dataset.action;
      if(action==='reset'){ try{ window.resetBoard && window.resetBoard(); }catch(err){} }
      if(action==='logout'){
        try{
          if(window.auth && auth.signOut){
            auth.signOut().then(()=>location.href='login.html').catch(()=>location.href='login.html');
          }else{
            // Fallback redirect
            location.href='login.html';
          }
        }catch(err){
          location.href='login.html';
        }
      }
    });
  }

  // avatar helper
  function avatarFromName(name){
    const c = (name||'?').trim().charAt(0).toUpperCase() || 'U';
    const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80'>
      <rect width='100%' height='100%' fill='#2b3441'/><text x='50%' y='55%' font-size='36' text-anchor='middle' fill='#e7ecf3' font-family='Inter,system-ui,sans-serif'>${c}</text>
    </svg>`);
    return `data:image/svg+xml;charset=utf-8,${svg}`;
  }

  // auth-aware UI (Firebase Auth expected as global "auth")
  if(window.auth && typeof auth.onAuthStateChanged === 'function'){
    auth.onAuthStateChanged(user=>{
      if(menu){
        menu.innerHTML = `
          <button class="menu-item" data-action="reset" role="menuitem">Reset</button>
          <a class="menu-item" href="signup.html" role="menuitem">Sign Up</a>
          <button class="menu-item" data-action="logout" role="menuitem">Log Out</button>
        `;
      }
      if(user){
        if(menu){
          menu.innerHTML = `
            <button class="menu-item" data-action="reset" role="menuitem">Reset</button>
            <button class="menu-item" data-action="logout" role="menuitem">Log Out</button>
          `;
        }
        if(userInfo){
          const name = user.displayName || (user.email ? user.email.split('@')[0] : 'User');
          const email = user.email || '';
          const photo = user.photoURL || avatarFromName(name);
          if(uName) uName.textContent = name;
          if(uEmail) uEmail.textContent = email;
          if(uPhoto) uPhoto.src = photo;
          userInfo.style.display = 'flex';
        }
      }else{
        if(userInfo) userInfo.style.display = 'none';
      }
    });
  }else{
    // If no Firebase present, still show signed-out menu
    if(userInfo) userInfo.style.display = 'none';
  }
})();
</script>

</body>
</html>
